# ChatBrew
**ChatBrew**是一个轻量级、单文件的 HTML 工具，专为 LLM（大语言模型）重度用户设计。它可以帮助你清洗、编辑、分段和导出聊天记录，使其成为完美的 RAG（检索增强生成）**知识库素材** 或 **高质量存档**。

无需安装，无需联网，直接在浏览器中打开即可使用。

## ✨ 核心功能

*   **🛠️ 多模式工作流**：提供「筛选」、「精修」、「阅览」三种视图，满足不同阶段的处理需求。
*   **✂️ RAG 智能分段**：支持在对话中手动插入“剪刀”标记，导出时自动生成适合 RAG 切片的段落分隔符。
*   **🧠 深度思考保护**：完美兼容 DeepSeek/O1 等模型的 `<think>` 思考链，支持折叠显示、导出保留或一键去除。
*   **🔄 存档回流重修**：支持导入标准 JSON 格式或 LogRefiner 导出的 TXT 文件，随时重新编辑旧存档。
*   **🎭 角色灵活定制**：支持自定义 User/AI 昵称，并可在精修模式下快速纠正消息的角色归属。

---

## 🚀 快速开始

1.  下载本项目中的 `.html` 文件（例如 `LogRefiner.html`）。
2.  双击文件，使用 Chrome、Edge 或 Safari 等现代浏览器打开。
3.  拖入你的聊天记录文件（`.json` 或 `.txt`）即可开始工作。

---

## 📖 使用指南

### 1. 导入数据 (Import)
*   **JSON 导入**：支持常见的 Chatbox、SillyTavern 等导出的符合 OpenAI 格式的 JSON。
*   **TXT 导入（回流）**：支持导入本工具此前导出的 TXT 文件。
    *   ⚠️ **注意**：如果您的 TXT 文件中使用了自定义昵称（如“张三”和“DeepSeek”），请在导入前，先在侧边栏的 **“角色定制”** 输入框中填入对应的名字，否则可能会识别错误。

### 2. 筛选模式 (Filter Mode) 🛠️
这是处理数据的第一步，决定哪些内容需要保留，以及在哪里分段。

*   **勾选/取消**：点击消息行（或使用右上角全选/反选）来决定这条消息是否导出。
*   **时间过滤**：在侧边栏开启“增量过滤”，选择时间点，只处理该时间之后的对话。
*   **✂️ 插入分段点（RAG 核心功能）**：
    *   鼠标悬停在消息右侧，点击 **✂️ (剪刀图标)**。
    *   消息下方会出现虚线 `--- ✂️ 分段点 ---`。
    *   **作用**：导出时，该位置会插入 **4个换行符**（常规间隔为2个）。在后期制作知识库时，您可以利用这个特征将长对话精准切分为独立的语义块。

### 3. 精修模式 (Edit Mode) ✏️
这是处理文本细节的阶段。

*   **编辑内容**：直接点击文本内容即可进行修改（所见即所得）。
*   **删除消息**：点击右上角的 `×` 删除不需要的单条对话。
*   **🎭 切换角色**：如果某条消息的角色识别错误（例如 User 变成了 AI），**点击左上角的“User/AI”标签**，即可一键切换该条消息的归属。

### 4. 导出 (Export) ✨
在侧边栏调整导出选项：
*   **保留时间戳**：是否在名字后附加 `[202X-XX-XX]` 时间。
*   **去除 <think>**：导出时是否剔除 AI 的思考过程（适合制作纯对话语料）。
*   **防碎 (压扁换行)**：将消息内的单次换行替换为空格，仅保留段落间的换行。这有助于保持语料的紧凑性。

点击顶部按钮导出：
*   **MD (Markdown)**：适合阅读或导入 Notion/Obsidian。
*   **TXT (纯文本)**：适合作为 LLM 的训练语料或 RAG 知识库源文件（支持回流重新编辑）。

---

## ❓ 常见问题 (FAQ)

**Q: 为什么重新导入 TXT 后，所有的消息都变成了 User？**
A: 这是因为工具没能识别出 TXT 中的名字。
**解决方法**：在点击“导入”按钮**之前**，请务必在侧边栏的“角色定制”中，将“User昵称”和“AI昵称”修改为您 TXT 文件中实际使用的名字（例如 User: "我", AI: "助手"）。

**Q: 为什么我的 `<think>` 思考内容在导出后丢失了？**
A: 请检查侧边栏的 **“去除 <think>”** 开关是否被开启。如果需要保留思考过程，请关闭该开关。

**Q: "分段点" (✂️) 具体有什么用？**
A: 它是为了 RAG (检索增强生成) 准备的。普通的对话导出后是连续的，导入知识库（如 Dify, FastGPT）时容易被切碎。使用分段点，导出文件中会出现明显的空行隔断，您可以配置知识库的清洗规则（例如：`\n\n\n\n` 作为分隔符），从而保证每个知识切片的完整性。

---

## 🔒 隐私说明

LogRefiner 是一个**纯前端**工具。
*   所有数据处理均在您的**本地浏览器**内存中完成。
*   **不会**将您的聊天记录上传到任何服务器。
*   您可以断网使用，绝对安全。

---

*Enjoy your clean data! ☕️*
